"use strict";var N=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var H=(e,n)=>{for(var t in n)N(e,t,{get:n[t],enumerable:!0})},Y=(e,n,t,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of q(n))!G.call(e,r)&&r!==t&&N(e,r,{get:()=>n[r],enumerable:!(i=X(n,r))||i.enumerable});return e};var Z=e=>Y(N({},"__esModule",{value:!0}),e);var pe={};H(pe,{MedplumProvider:()=>ee,reactContext:()=>C,useCachedBinaryUrl:()=>te,useMedplum:()=>l,useMedplumContext:()=>M,useMedplumNavigate:()=>$,useMedplumProfile:()=>j,usePrevious:()=>re,useResource:()=>oe,useSearch:()=>ie,useSearchOne:()=>ue,useSearchResources:()=>ce,useSubscription:()=>de});module.exports=Z(pe);var g=require("react");var T=require("react"),C=(0,T.createContext)(void 0);function M(){return(0,T.useContext)(C)}function l(){return M().medplum}function $(){return M().navigate}function j(){return M().profile}var _=require("react/jsx-runtime"),V=["change","storageInitialized","storageInitFailed","profileRefreshing","profileRefreshed"];function ee(e){let n=e.medplum,t=e.navigate??ne,[i,r]=(0,g.useState)({profile:n.getProfile(),loading:n.isLoading()});(0,g.useEffect)(()=>{function o(){r(c=>({...c,profile:n.getProfile(),loading:n.isLoading()}))}for(let c of V)n.addEventListener(c,o);return()=>{for(let c of V)n.removeEventListener(c,o)}},[n]);let u=(0,g.useMemo)(()=>({...i,medplum:n,navigate:t}),[i,n,t]);return(0,_.jsx)(C.Provider,{value:u,children:e.children})}function ne(e){window.location.assign(e)}var A=require("react"),z=new Map,te=e=>(0,A.useMemo)(()=>{if(!e)return;let n=e.split("?")[0];if(!n)return e;let t;try{t=new URLSearchParams(new URL(e).search)}catch{return e}if(!t.has("Key-Pair-Id")||!t.has("Signature"))return e;let i=t.get("Expires");if(!i||i.length>13)return e;let r=z.get(n);if(r){let o=new URLSearchParams(new URL(r).search).get("Expires");if(o&&parseInt(o,10)*1e3-5e3>Date.now())return r}return z.set(n,e),e},[e]);var y=require("react");function re(e){let n=(0,y.useRef)();return(0,y.useEffect)(()=>{n.current=e}),n.current}var f=require("@medplum/core"),v=require("react");function oe(e,n){let t=l(),[i,r]=(0,v.useState)(()=>Q(t,e)),u=(0,v.useCallback)(o=>{(0,f.deepEquals)(o,i)||r(o)},[i]);return(0,v.useEffect)(()=>{let o=!0,c=Q(t,e);return!c&&(0,f.isReference)(e)?t.readReference(e).then(a=>{o&&u(a)}).catch(a=>{o&&(u(void 0),n&&n((0,f.normalizeOperationOutcome)(a)))}):u(c),()=>o=!1},[t,e,u,n]),i}function Q(e,n){if(n){if((0,f.isResource)(n))return n;if((0,f.isReference)(n))return e.getCachedReference(n)}}var P=require("@medplum/core"),b=require("react");var p=require("react");function J(e,n,t={leading:!1}){let[i,r]=(0,p.useState)(e),u=(0,p.useRef)(!1),o=(0,p.useRef)(),c=(0,p.useRef)(!1),a=(0,p.useCallback)(()=>window.clearTimeout(o.current),[]);return(0,p.useEffect)(()=>{u.current&&(!c.current&&t.leading?(c.current=!0,r(e)):(a(),o.current=setTimeout(()=>{c.current=!1,r(e)},n)))},[e,t.leading,n,a]),(0,p.useEffect)(()=>(u.current=!0,a),[a]),[i,a]}var se=250;function ie(e,n,t){return w("search",e,n,t)}function ue(e,n,t){return w("searchOne",e,n,t)}function ce(e,n,t){return w("searchResources",e,n,t)}function w(e,n,t,i){let r=l(),[u,o]=(0,b.useState)(),[c,a]=(0,b.useState)(!0),[S,m]=(0,b.useState)(),[x,h]=(0,b.useState)(),O=r.fhirSearchUrl(n,t).toString(),[R]=J(O,i?.debounceMs??se,{leading:!0});return(0,b.useEffect)(()=>{R!==u&&(o(R),r[e](n,t).then(E=>{a(!1),m(E),h(P.allOk)}).catch(E=>{a(!1),m(void 0),h((0,P.normalizeOperationOutcome)(E))}))},[r,e,n,t,u,R]),[S,c,x]}var F=require("@medplum/core"),s=require("react");var ae=3e3;function de(e,n,t){let i=l(),[r,u]=(0,s.useState)(),[o,c]=(0,s.useState)(t?.subscriptionProps),a=(0,s.useRef)(!1),S=(0,s.useRef)(),m=(0,s.useRef)(),x=(0,s.useRef)(),h=(0,s.useRef)();h.current=n;let O=(0,s.useRef)();O.current=t?.onWebSocketOpen;let R=(0,s.useRef)();R.current=t?.onWebSocketClose;let E=(0,s.useRef)();E.current=t?.onSubscriptionConnect;let W=(0,s.useRef)();W.current=t?.onSubscriptionDisconnect;let B=(0,s.useRef)();B.current=t?.onError,(0,s.useEffect)(()=>{(0,F.deepEquals)(t?.subscriptionProps,o)||c(t?.subscriptionProps)},[o,t]),(0,s.useEffect)(()=>{S.current&&(clearTimeout(S.current),S.current=void 0);let d=!1;return(m.current!==e||!(0,F.deepEquals)(x.current,o))&&(d=!0),d&&m.current&&i.unsubscribeFromCriteria(m.current,x.current),m.current=e,x.current=o,d&&e?u(i.subscribeToCriteria(e,o)):e||u(void 0),()=>{S.current=setTimeout(()=>{u(void 0),e&&i.unsubscribeFromCriteria(e,o)},ae)}},[i,e,o]);let L=(0,s.useCallback)(d=>{h.current?.(d.payload)},[]),K=(0,s.useCallback)(()=>{O.current?.()},[]),k=(0,s.useCallback)(()=>{R.current?.()},[]),U=(0,s.useCallback)(d=>{E.current?.(d.payload.subscriptionId)},[]),D=(0,s.useCallback)(d=>{W.current?.(d.payload.subscriptionId)},[]),I=(0,s.useCallback)(d=>{B.current?.(d.payload)},[]);(0,s.useEffect)(()=>r?(a.current||(r.addEventListener("message",L),r.addEventListener("open",K),r.addEventListener("close",k),r.addEventListener("connect",U),r.addEventListener("disconnect",D),r.addEventListener("error",I),a.current=!0),()=>{a.current=!1,r.removeEventListener("message",L),r.removeEventListener("open",K),r.removeEventListener("close",k),r.removeEventListener("connect",U),r.removeEventListener("disconnect",D),r.removeEventListener("error",I)}):()=>{},[r,L,K,k,U,D,I])}
//# sourceMappingURL=index.cjs.map
