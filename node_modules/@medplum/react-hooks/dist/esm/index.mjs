import{useEffect as Q,useMemo as J,useState as X}from"react";import{createContext as z,useContext as A}from"react";var y=z(void 0);function P(){return A(y)}function b(){return P().medplum}function fe(){return P().navigate}function me(){return P().profile}import{jsx as G}from"react/jsx-runtime";var I=["change","storageInitialized","storageInitFailed","profileRefreshing","profileRefreshed"];function ge(e){let n=e.medplum,t=e.navigate??q,[s,r]=X({profile:n.getProfile(),loading:n.isLoading()});Q(()=>{function o(){r(u=>({...u,profile:n.getProfile(),loading:n.isLoading()}))}for(let u of I)n.addEventListener(u,o);return()=>{for(let u of I)n.removeEventListener(u,o)}},[n]);let i=J(()=>({...s,medplum:n,navigate:t}),[s,n,t]);return G(y.Provider,{value:i,children:e.children})}function q(e){window.location.assign(e)}import{useMemo as H}from"react";var N=new Map,Oe=e=>H(()=>{if(!e)return;let n=e.split("?")[0];if(!n)return e;let t;try{t=new URLSearchParams(new URL(e).search)}catch{return e}if(!t.has("Key-Pair-Id")||!t.has("Signature"))return e;let s=t.get("Expires");if(!s||s.length>13)return e;let r=N.get(n);if(r){let o=new URLSearchParams(new URL(r).search).get("Expires");if(o&&parseInt(o,10)*1e3-5e3>Date.now())return r}return N.set(n,e),e},[e]);import{useEffect as Y,useRef as Z}from"react";function Me(e){let n=Z();return Y(()=>{n.current=e}),n.current}import{deepEquals as $,isReference as F,isResource as j,normalizeOperationOutcome as ee}from"@medplum/core";import{useCallback as ne,useEffect as te,useState as re}from"react";function Ue(e,n){let t=b(),[s,r]=re(()=>w(t,e)),i=ne(o=>{$(o,s)||r(o)},[s]);return te(()=>{let o=!0,u=w(t,e);return!u&&F(e)?t.readReference(e).then(c=>{o&&i(c)}).catch(c=>{o&&(i(void 0),n&&n(ee(c)))}):i(u),()=>o=!1},[t,e,i,n]),s}function w(e,n){if(n){if(j(n))return n;if(F(n))return e.getCachedReference(n)}}import{allOk as ie,normalizeOperationOutcome as ue}from"@medplum/core";import{useEffect as ce,useState as v}from"react";import{useCallback as oe,useEffect as W,useRef as L,useState as se}from"react";function B(e,n,t={leading:!1}){let[s,r]=se(e),i=L(!1),o=L(),u=L(!1),c=oe(()=>window.clearTimeout(o.current),[]);return W(()=>{i.current&&(!u.current&&t.leading?(u.current=!0,r(e)):(c(),o.current=setTimeout(()=>{u.current=!1,r(e)},n)))},[e,t.leading,n,c]),W(()=>(i.current=!0,c),[c]),[s,c]}var ae=250;function ze(e,n,t){return K("search",e,n,t)}function Ae(e,n,t){return K("searchOne",e,n,t)}function Qe(e,n,t){return K("searchResources",e,n,t)}function K(e,n,t,s){let r=b(),[i,o]=v(),[u,c]=v(!0),[f,p]=v(),[R,E]=v(),g=r.fhirSearchUrl(n,t).toString(),[m]=B(g,s?.debounceMs??ae,{leading:!0});return ce(()=>{m!==i&&(o(m),r[e](n,t).then(l=>{c(!1),p(l),E(ie)}).catch(l=>{c(!1),p(void 0),E(ue(l))}))},[r,e,n,t,i,m]),[f,u,R]}import{deepEquals as V}from"@medplum/core";import{useCallback as S,useEffect as k,useRef as d,useState as _}from"react";var de=3e3;function Ze(e,n,t){let s=b(),[r,i]=_(),[o,u]=_(t?.subscriptionProps),c=d(!1),f=d(),p=d(),R=d(),E=d();E.current=n;let g=d();g.current=t?.onWebSocketOpen;let m=d();m.current=t?.onWebSocketClose;let l=d();l.current=t?.onSubscriptionConnect;let U=d();U.current=t?.onSubscriptionDisconnect;let D=d();D.current=t?.onError,k(()=>{V(t?.subscriptionProps,o)||u(t?.subscriptionProps)},[o,t]),k(()=>{f.current&&(clearTimeout(f.current),f.current=void 0);let a=!1;return(p.current!==e||!V(R.current,o))&&(a=!0),a&&p.current&&s.unsubscribeFromCriteria(p.current,R.current),p.current=e,R.current=o,a&&e?i(s.subscribeToCriteria(e,o)):e||i(void 0),()=>{f.current=setTimeout(()=>{i(void 0),e&&s.unsubscribeFromCriteria(e,o)},de)}},[s,e,o]);let x=S(a=>{E.current?.(a.payload)},[]),h=S(()=>{g.current?.()},[]),O=S(()=>{m.current?.()},[]),T=S(a=>{l.current?.(a.payload.subscriptionId)},[]),C=S(a=>{U.current?.(a.payload.subscriptionId)},[]),M=S(a=>{D.current?.(a.payload)},[]);k(()=>r?(c.current||(r.addEventListener("message",x),r.addEventListener("open",h),r.addEventListener("close",O),r.addEventListener("connect",T),r.addEventListener("disconnect",C),r.addEventListener("error",M),c.current=!0),()=>{c.current=!1,r.removeEventListener("message",x),r.removeEventListener("open",h),r.removeEventListener("close",O),r.removeEventListener("connect",T),r.removeEventListener("disconnect",C),r.removeEventListener("error",M)}):()=>{},[r,x,h,O,T,C,M])}export{ge as MedplumProvider,y as reactContext,Oe as useCachedBinaryUrl,b as useMedplum,P as useMedplumContext,fe as useMedplumNavigate,me as useMedplumProfile,Me as usePrevious,Ue as useResource,ze as useSearch,Ae as useSearchOne,Qe as useSearchResources,Ze as useSubscription};
//# sourceMappingURL=index.mjs.map
